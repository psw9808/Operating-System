# 운영체제 
## H.W 3
### 2017114559	박선우
# 1.	개요
1-	 pthread 라이브러리 또는 자바 스레드로 여러 스레드가 하나의 전역변수에 동시에 접근해서 충돌이 발생하는 문제를 재현하고 mutex 또는 synchronized를 사용하여 이 문제를 해결하기 
2-	행렬 곱셈을 수행하는 단일스레드와 멀티스레드 프로그램을 작성하여 수행 시간 비교하기 행렬을 생성하는 방법은 무관(유저 입력, 랜덤생성, 미리 만들어진 행렬 등)
# 2.	프로그램 구조 설명
## 2.1) 함수에 대한 설명
### 1번 프로그램
- Main : 쓰레드 개수 입력받아 그 수만큼 쓰레드 생성, 쓰레드 종료시 메시지와 함께 결과 출력
- Busywork : 전역변수 global에 반복해서 1을 빼고 더하는 함수.
### 2번 행렬 계산 프로그램
- Main : 두 행렬의 내용을 표시하고 행렬 곱을 계산한 후 그 결과를 나타내는 역할
- Mat : 행렬 계산 함수, 행렬 곱의 연산을 한 행씩 수행한다.

## 2.2) 다이어그램
- 1번 프로그램
  
- 2번 행렬 계산 프로그램
 
# 3.	실행 결과
## 1-1 여러 스레드가 하나의 전역변수에 동시접근시 충돌문제
 
## 1-2 mutex 사용하여 충돌문제 해결
 
## 2 행렬 곱셈 수행시 단일스레드와 멀티스레드 프로그램 수행시간 비교
 

# 4.	고찰
이번 숙제에서는 pthread 명령어를 이용하여 멀티 쓰레드 프로그래밍을 직접 해보았다. 
처음 해보는 쓰레드 프로그램이라 많은 오류를 거치면서 힘들게 한 것 같다. 
그래도 ppt 내용에 있는 pthread 예제와 조교님이 올려 주신 시간 측정 예제가 숙제하는데 큰 도움이 되었다. 

멀티 쓰레드 프로그램을 만들어 보면서 신기했던 점은 전역변수에 동시에 여러 쓰레드가 접근하면서 값이 깨지는 것을 직접 눈으로 확인할 수 있었고, 이 문제를 mutex를 사용하여 해결해보면서 멀티쓰레드 사용시 어떤 식으로 데이터 접근 충돌을 막을 수 있는지 잘 알게 되었다.

또한 싱글 쓰레드와 멀티 쓰레드 프로그램의 수행 시간을 각각 측정해 비교해본 결과도 아주 놀라웠는데 내 생각으로는 쓰레드가 많아지면 더 적은 수행시간이 걸릴 것으로 예상했지만, 실제 결과는 멀티 쓰레드 프로그램이 싱글 쓰레드보다 무려 1000배 이상 수행시간이 오래 걸리는 결과가 나타났다. 이 현상의 원인을 한번 생각해 보았다.

첫째 수행하는 프로그램이 너무 단순하기 때문에 싱글쓰레드보다 오히려 멀티쓰레드의 수행시간이 더 크게 나왔다.

둘째 쓰레드 수행 코드 사이에 for문을 통한 반복작업이 들어가는데 이것 때문에 쓰레드 작업이 길어지는 결과가 나오지 않았나 싶다.

셋째 쓰레드 조인을 통해 쓰레드가 모두 종료될 때까지 기다려주는데 이것 때문에 시간이 더 지체된 것으로 보인다.

따라서 더욱 복잡한 작업을 수행할 경우에는 멀티 쓰레드 프로그램이 더 짧은 수행시간을 가질 것으로 예상된다.

프로그램을 짜면서 포인터를 통해 쓰레드에 전달 인자를 넘겨주면서 Segmentation fault (core dumped) 에러가 발생하여 행렬을 전역변수로 설정하고 쓰레드 번호를 나타내기 위한 변수 하나만 전달 인자로 쓰레드에 전달하였다. 

쓰레드에 전달 인자를 줄 때 여러 개를 넘겨주려면 구조체로 만들어서 넘겨줘야 한다는 점이 불편했다. 

그래도 이번 숙제를 하며 멀티 쓰레드 프로그래밍이 어떤 경우에 효과적이며 어떤 식으로 돌아가고 사용할 수 있는지 알게 된 것 같다.

# 5.	프로그램 소스 코드
- 1번 프로그램 Main.c
 
 
 
- 2번 프로그램 Matrix.c
 
 
 
# 6.	자료 출처

Ppt pthread 예제 참조

Mutex 예제

https://bitsoul.tistory.com/172

다이어그램 만드는 사이트

https://www.draw.io/

행렬 연산 예제

https://github.com/yh08037/Cdaily/tree/master/day2%20%ED%96%89%EB%A0%AC%EA%B3%B1
